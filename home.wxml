<view class="home-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- é¡µé¢å†…å®¹ -->
  <view class="home-content" wx:else>
    <!-- é¡¶éƒ¨æ¸å˜èƒŒæ™¯ -->
    <view class="header-bg"></view>
    
    <!-- é¡¶éƒ¨æ  -->
    <view class="top-bar">
      <view class="greeting-section">
        <text class="greeting">{{greeting}}</text>
        <text class="user-name" wx:if="{{userInfo}}">{{userInfo.nickname}}</text>
        <text class="user-name" wx:else>æ¬¢è¿ä½¿ç”¨è‹±è¯­å¬ä¹¦</text>
      </view>
      <view class="avatar-section" bindtap="goToProfile">
        <image src="{{userInfo ? userInfo.avatar : '/images/avatar/default.png'}}" class="user-avatar" />

      </view>
    </view>
    
    <!-- æœç´¢æ  -->
    <view class="search-section">
      <view class="search-container" bindtap="onSearchTap">
        <text class="search-icon">ğŸ”</text>
        <input 
          class="search-input" 
          placeholder="æœç´¢ä¹¦ç±ã€ä½œè€…æˆ–åˆ†ç±»..." 
          placeholder-class="search-placeholder"
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          confirm-type="search"
        />
        <text class="search-clear" wx:if="{{searchKeyword}}" bindtap="clearSearch">âœ•</text>
        <view class="search-action" bindtap="onSearchTap">
          <text class="search-button">æœç´¢</text>
        </view>
      </view>
    </view>
    
    <!-- æœç´¢ç»“æœå¼¹å±‚ -->
    <view class="search-results-layer" wx:if="{{showSearchResults}}">
      <view class="search-results-container">
        <view class="search-results-header">
          <text class="search-results-title">
            {{searchResults.length > 0 ? 'æœç´¢ç»“æœ (' + searchResults.length + ')' : 'æœç´¢ç»“æœ'}}
          </text>
          <text class="search-close" bindtap="clearSearch">å…³é—­</text>
        </view>
        
        <!-- æœç´¢ä¸­çŠ¶æ€ -->
        <view class="search-loading-placeholder" wx:if="{{isSearching}}">
          <view class="loading-spinner-small"></view>
          <text class="loading-text">æœç´¢ä¸­...</text>
        </view>
        
        <!-- æ— æ•°æ®å ä½ -->
        <view class="search-empty-placeholder" wx:if="{{!isSearching && searchResults.length === 0}}">
          <image src="/images/empty/search-empty.png" class="empty-image" />
          <text class="empty-title">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</text>
          <text class="empty-desc">æ¢ä¸ªå…³é”®è¯è¯•è¯•å§</text>
          <view class="empty-action" bindtap="clearSearch">
            <text class="empty-action-text">è¿”å›æœç´¢</text>
          </view>
        </view>
        
        <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
        <scroll-view 
          class="search-results-list" 
          scroll-y="true"
          wx:if="{{!isSearching && searchResults.length > 0}}">
          <view class="search-result-item" 
                wx:for="{{searchResults}}" 
                wx:key="id"
                data-id="{{item.id}}"
                bindtap="onSearchResultTap">
            <image src="{{item.cover || '/images/covers/default.jpg'}}" class="result-cover" />
            <view class="result-info">
              <text class="result-title">{{item.title}}</text>
              <text class="result-author">{{item.author}}</text>
              <view class="result-meta">
                <text class="meta-item">ğŸ§ {{item.playCount || 0}}</text>
                <text class="meta-item">â­ {{item.rating || '0.0'}}</text>
                <text class="meta-item" wx:if="{{item.duration}}">{{item.duration}}</text>
              </view>
            </view>
          </view>
        </scroll-view>
      </view>
    </view>
    
    <!-- è½®æ’­å›¾ -->
    <view class="banner-section">
      <swiper class="banner-swiper" 
              indicator-dots="{{true}}" 
              indicator-color="rgba(255,255,255,0.4)"
              indicator-active-color="#FFFFFF"
              autoplay="{{true}}" 
              interval="{{3000}}" 
              circular="{{true}}"
              current="{{bannerIndex}}"
              bindchange="onBannerChange">
        <block wx:for="{{banners}}" wx:key="id">
          <swiper-item>
            <view class="banner-item" data-id="{{item.id}}" bindtap="onBannerTap">
              <image src="{{item.imageUrl}}" class="banner-image" mode="aspectFill" />
              <view class="banner-overlay" style="background: linear-gradient(to top, {{item.color}}99, transparent 60%)">
                <view class="banner-content">
                  <text class="banner-title">{{item.title}}</text>
                  <text class="banner-subtitle">{{item.subtitle}}</text>
                </view>
              </view>
            </view>
          </swiper-item>
        </block>
      </swiper>
      <view class="banner-indicator">
        <text class="banner-current">{{bannerIndex + 1}}</text>
        <text class="banner-divider">/</text>
        <text class="banner-total">{{banners.length}}</text>
      </view>
    </view>
    
    <!-- å¿«æ·åŠŸèƒ½ -->
    <view class="quick-actions-section">
      <view class="section-header">
        <text class="section-title">âš¡ å¿«æ·åŠŸèƒ½</text>
      </view>
      <scroll-view class="quick-actions-scroll" scroll-x="true">
        <view class="quick-actions-list" >
          <view class="quick-action-item" 
                wx:for="{{quickActions}}" 
                wx:key="id"
                data-id="{{item.id}}"
                data-page="{{item.page}}"
                bindtap="onQuickActionTap">
            <view class="action-icon" style="background-color: {{item.color}}20">
              <text class="action-emoji">{{item.icon}}</text>
            </view>
            <text class="action-name">{{item.name}}</text>
          </view>
        </view>
      </scroll-view>
    </view>
    

    
    <!-- ä»Šæ—¥æ¨è -->
    <view wx:if="{{dailyRecommendation}}" 
      class="daily-section" 
      bindtap="onDailyRecommendTap"
      bindlongpress="onDailyLongPress">
      <view class="daily-card">
        <view class="daily-badge">ğŸ¯ ä»Šæ—¥æ¨è</view>
        <image src="{{dailyRecommendation.cover}}" class="daily-cover" />
        <view class="daily-info">
          <text class="daily-title">{{dailyRecommendation.title}}</text>
          <text class="daily-author">{{dailyRecommendation.author}}</text>
          <text class="daily-desc">{{dailyRecommendation.description}}</text>
          <text class="daily-reason">{{dailyRecommendation.reason}}</text>
        </view>
        <view class="daily-action">
          <text class="daily-button">ç«‹å³æ”¶å¬</text>
        </view>
      </view>
    </view>
    
    <!-- ğŸ†• ä»Šæ—¥æ¨èç©ºçŠ¶æ€ -->
    <view class="daily-empty-placeholder" wx:if="{{!dailyRecommendation && !isLoading}}">
      <view class="daily-empty-card">
        <image src="/images/empty/daily-empty.png" class="empty-image" />
        <text class="empty-title">æš‚æ— ä»Šæ—¥æ¨è</text>
        <text class="empty-desc">éšæœºæ”¶å¬ä¸€æœ¬ä¹¦ç±å§</text>
        <view class="empty-action" bindtap="randomPlay">
          <text class="empty-action-text">éšæœºæ’­æ”¾</text>
        </view>
      </view>
    </view>
    
    <!-- çƒ­é—¨ä¹¦ç± -->
    <view class="hot-books-section">
      <view class="section-header">
        <text class="section-title">ğŸ”¥ çƒ­é—¨æ¨è</text>
        <text class="section-more" bindtap="goToHotList">æ›´å¤š</text>
      </view>
      
      <!-- ğŸ†• çƒ­é—¨ä¹¦ç±ç©ºçŠ¶æ€ -->
      <view class="books-empty-placeholder" wx:if="{{!isLoading && hotBooks.length === 0}}">
        <image src="/images/empty/books-empty.png" class="empty-image" />
        <text class="empty-title">æš‚æ— çƒ­é—¨ä¹¦ç±</text>
        <text class="empty-desc">æ•°æ®åŠ è½½ä¸­æˆ–æš‚æ— æ¨è</text>
        <view class="empty-action" bindtap="retryLoad">
          <text class="empty-action-text">é‡æ–°åŠ è½½</text>
        </view>
      </view>
      
      <!-- çƒ­é—¨ä¹¦ç±åˆ—è¡¨ -->
      <scroll-view class="books-scroll" scroll-x="true" wx:if="{{hotBooks.length > 0}}">
        <view class="books-list">
          <view class="book-card" 
                wx:for="{{hotBooks}}" 
                wx:key="id"
                data-id="{{item.id}}"
                bindtap="goToBookDetail">
            <image src="{{item.cover}}" class="book-cover" />
            <view class="book-badge" wx:if="{{item.isFree}}">å…è´¹</view>
            <view class="book-info">
              <text class="book-title">{{item.title}}</text>
              <text class="book-author">{{item.author}}</text>
              <view class="book-meta">
                <view class="meta-item">
                  <text class="meta-icon">ğŸ§</text>
                  <text class="meta-text">{{item.playCount}}</text>
                </view>
                <view class="meta-item">
                  <text class="meta-icon">â­</text>
                  <text class="meta-text">{{item.rating}}</text>
                </view>
                <view class="meta-item">
                  <text class="meta-icon">â°</text>
                  <text class="meta-text">{{item.duration}}</text>
                </view>
              </view>
              <view class="book-tags">
                <text class="book-tag" wx:for="{{item.tags}}" wx:key="*this">{{item}}</text>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
    
    <!-- æ¨èåˆ†ç±» -->
    <view class="categories-section">
      <view class="section-header">
        <text class="section-title">ğŸ“š çƒ­é—¨åˆ†ç±»</text>
        <text class="section-more" bindtap="goToAllCategories">å…¨éƒ¨</text>
      </view>
      
      <!-- ğŸ†• åˆ†ç±»ç©ºçŠ¶æ€ -->
      <view class="categories-empty-placeholder" wx:if="{{!isLoading && recommendedCategories.length === 0}}">
        <text class="empty-title">æš‚æ— åˆ†ç±»æ•°æ®</text>
        <text class="empty-desc">æ­£åœ¨åŠ è½½åˆ†ç±»ä¿¡æ¯</text>
      </view>
      
      <!-- åˆ†ç±»åˆ—è¡¨ -->
      <view class="categories-grid" wx:if="{{recommendedCategories.length > 0}}">
  <view class="category-card" 
        wx:for="{{recommendedCategories}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="goToCategory"
        style="background: {{item.color}};">
    <view class="category-icon">
      <text class="category-emoji">{{item.icon || 'ğŸ“š'}}</text>
    </view>
    <view class="category-info">
      <text class="category-name">{{item.name}}</text>
      <text class="category-enname">{{item.enName}}</text>
      <text class="category-count">{{item.bookCount}} æœ¬ä¹¦</text>
    </view>
    <view class="category-arrow">â†’</view>
  </view>
      </view>

      <!-- ğŸš¨ æ·»åŠ è°ƒè¯•å—ï¼Œå¿«é€ŸæŸ¥çœ‹æ•°æ® -->
      <view wx:if="{{false}}" style="padding: 20rpx; background: #f5f5f5; margin: 20rpx; border-radius: 10rpx;">
  <text style="color: #333; font-weight: bold;">è°ƒè¯•ä¿¡æ¯ï¼š</text>
  <text style="color: #666;">{{recommendedCategories.length}} ä¸ªåˆ†ç±»</text>
  <view wx:for="{{recommendedCategories}}" wx:for-item="cat" style="margin-top: 10rpx;">
    <text style="color: #ff5500;">{{cat.name}}: </text>
    <text style="color: #666;">color={{cat.color}}, icon={{cat.icon}}</text>
  </view>
      </view>
    </view>
    
    <!-- åº•éƒ¨åŠŸèƒ½åŒº -->
    <view class="bottom-section">
      <!-- éšæœºæ’­æ”¾ -->
      <view class="random-play-card" bindtap="randomPlay" animation="{{randomButtonAnimation}}">
        <view class="random-icon">ğŸ²</view>
        <view class="random-info">
          <text class="random-title">éšæœºæ’­æ”¾</text>
          <text class="random-desc">è¯•è¯•ä½ çš„å¬åŠ›è¿æ°”</text>
        </view>
        <view class="random-button">å¼€å§‹</view>
      </view>
      
      <!-- æ­£åœ¨æ’­æ”¾ -->
      <view class="now-playing-card" wx:if="{{nowPlaying}}" bindtap="onNowPlayingTap">
        <view class="now-playing-badge">ğŸ§ æ­£åœ¨æ’­æ”¾</view>
        <image src="{{nowPlaying.cover}}" class="now-playing-cover" />
        <view class="now-playing-info">
          <text class="now-playing-title">{{nowPlaying.bookTitle}}</text>
          <text class="now-playing-chapter">{{nowPlaying.chapter}}</text>
          <view class="now-playing-progress">
            <view class="progress-bar small">
              <view class="progress-fill" style="width: {{nowPlaying.progress}}%;"></view>
            </view>
            <text class="progress-percent">{{nowPlaying.progress}}%</text>
          </view>
        </view>
        <view class="now-playing-action">
          <text class="play-icon">â–¶ï¸</text>
        </view>
      </view>
    </view>
    
    <!-- ç‰ˆæƒä¿¡æ¯ -->
    <view class="footer">
      <text class="footer-text">è‹±è¯­å¬ä¹¦ - æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹</text>
    </view>
  </view>
</view>