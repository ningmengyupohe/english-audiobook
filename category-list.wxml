<!-- å¯¼èˆªæ  -->
<view class="nav-bar">
  <view class="nav-back" bindtap="goBack">
    <text class="nav-icon">â¬…ï¸</text>
  </view>
  <text class="nav-title">{{categoryName}}</text>
  <view style="width: 60rpx"></view>
</view>

<view class="category-container">
  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <view class="filter-tabs">
      <view 
        class="filter-tab {{filterIndex === 0 ? 'active' : ''}}" 
        data-index="0" 
        bindtap="changeFilter"
      >
        æœ€çƒ­
      </view>
      <view 
        class="filter-tab {{filterIndex === 1 ? 'active' : ''}}" 
        data-index="1" 
        bindtap="changeFilter"
      >
        æœ€æ–°
      </view>
      <view 
        class="filter-tab {{filterIndex === 2 ? 'active' : ''}}" 
        data-index="2" 
        bindtap="changeFilter"
      >
        æ¨è
      </view>
    </view>
    <view class="filter-more" bindtap="showMoreFilter">
      <text class="filter-icon">âš™ï¸</text>
      <text class="filter-text">ç­›é€‰</text>
    </view>
  </view>

  <!-- ä¹¦ç±åˆ—è¡¨ -->
  <scroll-view 
    class="book-list" 
    scroll-y 
    bindscrolltolower="loadMore"
    enable-back-to-top="true"
  >
    <!-- ç­›é€‰æ¡ä»¶æ˜¾ç¤º -->
    <view class="active-filters" wx:if="{{selectedDifficulty || minDuration || maxDuration}}">
      <text class="active-filter-text">å½“å‰ç­›é€‰ï¼š</text>
      <view class="filter-tags">
        <view class="filter-tag" wx:if="{{selectedDifficulty}}">
          <text class="filter-tag-text">éš¾åº¦ï¼š{{selectedDifficulty}}</text>
          <text class="filter-tag-remove" data-type="difficulty" bindtap="removeFilter">Ã—</text>
        </view>
        <view class="filter-tag" wx:if="{{minDuration}}">
          <text class="filter-tag-text">æ—¶é•¿â‰¥{{minDuration}}åˆ†é’Ÿ</text>
          <text class="filter-tag-remove" data-type="minDuration" bindtap="removeFilter">Ã—</text>
        </view>
        <view class="filter-tag" wx:if="{{maxDuration}}">
          <text class="filter-tag-text">æ—¶é•¿â‰¤{{maxDuration}}åˆ†é’Ÿ</text>
          <text class="filter-tag-remove" data-type="maxDuration" bindtap="removeFilter">Ã—</text>
        </view>
        <view class="filter-tag clear-all" bindtap="resetFilters">
          <text class="filter-tag-text">æ¸…é™¤æ‰€æœ‰</text>
        </view>
      </view>
    </view>

    <!-- ä¹¦ç±å¡ç‰‡åˆ—è¡¨ -->
    <view class="books-container">
      <block wx:for="{{bookList}}" wx:key="id">
        <view class="book-card" data-id="{{item.id}}" bindtap="goToBookDetail">
          <!-- ä¹¦ç±å°é¢ -->
          <view class="book-cover">
            <image src="{{item.cover}}" mode="aspectFill" class="cover-image"></image>
            <view class="cover-overlay">
              <text class="duration-text">{{item.duration}}åˆ†é’Ÿ</text>
              <view class="play-btn" data-id="{{item.id}}" bindtap="playBook" catchtap="stopPropagation">
                <text class="play-icon">â–¶ï¸</text>
              </view>
            </view>
            <view class="difficulty-badge">{{item.difficulty}}</view>
          </view>

          <!-- ä¹¦ç±ä¿¡æ¯ -->
          <view class="book-info">
            <view class="book-header">
              <text class="book-title">{{item.title}}</text>
              <view class="favorite-btn" data-id="{{item.id}}" bindtap="toggleFavorite" catchtap="stopPropagation">
                <text class="favorite-icon">{{item.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
              </view>
            </view>
            
            <text class="book-author">ğŸ‘¤ {{item.author}}</text>
            <text class="book-play-count">ğŸ‘ï¸ {{item.playCount}}æ¬¡æ’­æ”¾</text>
            
            <view class="book-description">
              <text class="description-text">{{item.description}}</text>
            </view>
          </view>
        </view>
      </block>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more">
      <text class="load-text" wx:if="{{isLoading}}">åŠ è½½ä¸­...</text>
      <text class="load-text" wx:if="{{!hasMore && !isLoading}}">æ²¡æœ‰æ›´å¤šäº†</text>
      <text class="load-text" wx:if="{{hasMore && !isLoading}}" bindtap="loadMore">ç‚¹å‡»åŠ è½½æ›´å¤š</text>
    </view>
  </scroll-view>

  <!-- æµ®åŠ¨æ’­æ”¾å™¨ -->
  <view class="floating-player" wx:if="{{currentPlayingBook}}" catchtap="goToPlayer">
    <view class="player-content">
      <image src="{{currentPlayingBook.cover}}" class="player-cover"></image>
      <view class="player-info">
        <text class="player-title">{{currentPlayingBook.title}}</text>
        <text class="player-subtitle">{{currentPlayingBook.author}}</text>
      </view>
      <view class="player-controls">
        <view class="player-btn stop-btn" bindtap="stopPlay" catchtap="stopPropagation">
          <text class="player-icon">â¹ï¸</text>
        </view>
        <view class="player-btn play-btn" bindtap="toggleFloatingPlay" catchtap="stopPropagation">
          <text class="player-icon">{{isPlaying ? 'â¸ï¸' : 'â–¶ï¸'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å¼¹çª— -->
  <view class="filter-modal" wx:if="{{showFilterModal}}">
    <view class="modal-mask" bindtap="hideFilterModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ç­›é€‰æ¡ä»¶</text>
        <view class="modal-close" bindtap="hideFilterModal">
          <text class="close-icon">Ã—</text>
        </view>
      </view>

      <view class="modal-body">
        <!-- éš¾åº¦ç­›é€‰ -->
        <view class="filter-section">
          <text class="filter-label">éš¾åº¦çº§åˆ«</text>
          <view class="difficulty-options">
            <block wx:for="{{difficultyOptions}}" wx:key="value">
              <view 
                class="difficulty-option {{selectedDifficulty === item.value ? 'active' : ''}}" 
                data-value="{{item.value}}" 
                bindtap="selectDifficulty"
              >
                <text class="difficulty-text">{{item.label}}</text>
              </view>
            </block>
          </view>
        </view>

        <!-- æ—¶é•¿ç­›é€‰ -->
        <view class="filter-section">
          <text class="filter-label">æ—¶é•¿èŒƒå›´ï¼ˆåˆ†é’Ÿï¼‰</text>
          <view class="duration-inputs">
            <view class="duration-input-group">
              <text class="duration-label">æœ€çŸ­</text>
              <input 
                type="number" 
                value="{{minDuration}}" 
                placeholder="0" 
                placeholder-class="placeholder"
                class="duration-input"
                bindinput="onMinDurationInput"
              />
            </view>
            <text class="duration-separator">-</text>
            <view class="duration-input-group">
              <text class="duration-label">æœ€é•¿</text>
              <input 
                type="number" 
                value="{{maxDuration}}" 
                placeholder="ä¸é™" 
                placeholder-class="placeholder"
                class="duration-input"
                bindinput="onMaxDurationInput"
              />
            </view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <view class="filter-btn reset-btn" bindtap="resetFilters">é‡ç½®</view>
        <view class="filter-btn apply-btn" bindtap="applyFilters">åº”ç”¨</view>
      </view>
    </view>
  </view>
</view>