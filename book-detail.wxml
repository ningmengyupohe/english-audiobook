<!-- å¯¼èˆªæ  -->
<view class="nav-bar">
  <view class="nav-back" bindtap="goBack">
    <text class="nav-icon">â¬…ï¸</text>
  </view>
  <text class="nav-title {{headerTitleVisible ? 'visible' : ''}}">{{bookInfo.title}}</text>
  <view class="nav-actions">
    <text class="nav-action-icon" bindtap="toggleFavorite">â¤ï¸</text>
  </view>
</view>

<scroll-view 
  class="detail-container" 
  scroll-y 
  bindscroll="onPageScroll"
  scroll-into-view="{{scrollIntoId}}"
>
  <!-- ä¹¦ç±å°é¢åŒºåŸŸ -->
  <view class="cover-section">
    <view class="cover-wrapper">
      <image src="{{bookInfo.cover}}" class="book-cover"></image>
      <view class="cover-badge">
        <text class="badge-text">{{bookInfo.difficultyText}}</text>
      </view>
    </view>
    
    <!-- ä¹¦ç±æ ‡é¢˜å’Œä¿¡æ¯ -->
    <view class="title-section">
      <text class="book-title">{{bookInfo.title}}</text>
      <text class="book-author">ğŸ‘¤ {{bookInfo.author}}</text>
      
      <!-- è¯„åˆ† -->
      <view class="rating-section">
        <view class="stars">
          <text class="star-icon">â­</text>
          <text class="star-icon">â­</text>
          <text class="star-icon">â­</text>
          <text class="star-icon">â­</text>
          <text class="star-icon {{bookInfo.rating >= 4.5 ? '' : 'half'}}">â­</text>
        </view>
        <text class="rating-text">{{bookInfo.rating}}åˆ† Â· {{bookInfo.ratingCount}}äººè¯„åˆ†</text>
      </view>
      
      <!-- æ•°æ®ç»Ÿè®¡ -->
      <view class="stats-section">
        <view class="stat-item">
          <text class="stat-icon">ğŸµ</text>
          <text class="stat-text">{{bookInfo.duration}}åˆ†é’Ÿ</text>
        </view>
        <view class="stat-item">
          <text class="stat-icon">ğŸ‘ï¸</text>
          <text class="stat-text">{{bookInfo.playCount}}æ¬¡æ’­æ”¾</text>
        </view>
        <view class="stat-item">
          <text class="stat-icon">ğŸ“–</text>
          <text class="stat-text">{{bookInfo.chapterCount}}ç« èŠ‚</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾åŒºåŸŸ -->
  <view class="tags-section">
    <block wx:for="{{bookInfo.tags}}" wx:key="index">
      <view class="tag-item">{{item}}</view>
    </block>
  </view>

  <!-- ä¸»è¦æ“ä½œæŒ‰é’® -->
  <view class="action-section">
    <view class="action-buttons">
      <view class="action-btn play-btn" bindtap="goToPlayer">
        <text class="action-icon">â–¶ï¸</text>
        <text class="action-text">æ’­æ”¾å…¨éƒ¨</text>
      </view>
      <view class="action-btn download-btn" bindtap="toggleDownload">
        <text class="action-icon">{{bookInfo.isDownloaded ? 'ğŸ“‚' : 'â¬‡ï¸'}}</text>
        <text class="action-text">{{bookInfo.isDownloaded ? 'å·²ä¸‹è½½' : 'ä¸‹è½½'}}</text>
      </view>
    </view>
  </view>

  <!-- æ’­æ”¾è¿›åº¦ -->
  <view class="progress-section" wx:if="{{playProgress > 0}}">
    <view class="progress-header">
      <text class="progress-title">ç»§ç»­æ’­æ”¾</text>
      <text class="progress-percent">{{playProgress}}%</text>
    </view>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{playProgress}}%;"></view>
    </view>
    <view class="progress-action">
      <text class="continue-btn" bindtap="continuePlaying">ç»§ç»­æ’­æ”¾</text>
    </view>
  </view>

  <!-- å†…å®¹ç®€ä»‹ -->
  <view class="description-section">
    <view class="section-header">
      <text class="section-title">ğŸ“ å†…å®¹ç®€ä»‹</text>
    </view>
    <view class="description-content {{expandedDescription ? 'expanded' : ''}}">
      <text class="description-text">{{bookInfo.description}}</text>
    </view>
    <view class="expand-btn" bindtap="toggleDescription">
      <text class="expand-text">{{expandedDescription ? 'æ”¶èµ·' : 'å±•å¼€å…¨éƒ¨'}}</text>
    </view>
  </view>

  <!-- ç« èŠ‚åˆ—è¡¨ -->
  <view class="chapters-section">
    <view class="section-header">
      <text class="section-title">ğŸ“š ç« èŠ‚åˆ—è¡¨</text>
      <text class="section-more" bindtap="showAllChapters">æŸ¥çœ‹å…¨éƒ¨({{chapters.length}})</text>
    </view>
    <view class="chapters-list">
      <block wx:for="{{chapters.slice(0, showAllChapters ? chapters.length : 5)}}" wx:key="id">
        <view class="chapter-item" data-index="{{index}}" bindtap="playChapter">
          <view class="chapter-info">
            <text class="chapter-number">ç¬¬{{index + 1}}ç« </text>
            <text class="chapter-title">{{item.title}}</text>
          </view>
          <view class="chapter-actions">
            <text class="chapter-duration">{{formatTime(item.duration)}}</text>
            <text class="chapter-status {{item.isCompleted ? 'completed' : ''}}">
              {{item.isCompleted ? 'âœ… å·²å¬å®Œ' : 'â–¶ï¸ æ’­æ”¾'}}
            </text>
          </view>
        </view>
      </block>
    </view>
    <view class="view-all-btn" wx:if="{{!showAllChapters && chapters.length > 5}}" bindtap="toggleShowAllChapters">
      <text class="view-all-text">æŸ¥çœ‹æ›´å¤šç« èŠ‚</text>
    </view>
  </view>

  <!-- å­¦ä¹ è¦ç‚¹ -->
  <view class="learning-section">
    <view class="section-header">
      <text class="section-title">ğŸ¯ å­¦ä¹ è¦ç‚¹</text>
    </view>
    <view class="learning-points">
      <view class="learning-item">
        <text class="learning-icon">ğŸ“</text>
        <view class="learning-content">
          <text class="learning-title">é‡ç‚¹è¯æ±‡</text>
          <text class="learning-value">{{bookInfo.vocabularyCount}}ä¸ª</text>
        </view>
      </view>
      <view class="learning-item">
        <text class="learning-icon">âœ¨</text>
        <view class="learning-content">
          <text class="learning-title">è¯­æ³•è¦ç‚¹</text>
          <text class="learning-value">{{bookInfo.grammarPoints}}ä¸ª</text>
        </view>
      </view>
      <view class="learning-item">
        <text class="learning-icon">ğŸ¯</text>
        <view class="learning-content">
          <text class="learning-title">é€‚åˆæ°´å¹³</text>
          <text class="learning-value">{{bookInfo.difficultyText}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç›¸ä¼¼æ¨è -->
  <view class="similar-section">
    <view class="section-header">
      <text class="section-title">ğŸ“š ç›¸ä¼¼æ¨è</text>
    </view>
    <scroll-view class="similar-list" scroll-x>
      <view class="similar-items">
        <block wx:for="{{similarBooks}}" wx:key="id">
          <view class="similar-item" data-id="{{item.id}}" bindtap="goToSimilarBook">
            <image src="{{item.cover}}" class="similar-cover"></image>
            <view class="similar-info">
              <text class="similar-title">{{item.title}}</text>
              <text class="similar-author">{{item.author}}</text>
            </view>
          </view>
        </block>
      </view>
    </scroll-view>
  </view>

  <!-- ç”¨æˆ·è¯„è®º -->
  <view class="comments-section">
    <view class="section-header">
      <text class="section-title">ğŸ’¬ ç”¨æˆ·è¯„è®º ({{commentCount}})</text>
      <text class="section-more" bindtap="goToComments">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    <view class="comments-list">
      <block wx:for="{{comments}}" wx:key="id">
        <view class="comment-item">
          <image src="{{item.avatar}}" class="comment-avatar"></image>
          <view class="comment-content">
            <view class="comment-header">
              <text class="comment-username">{{item.username}}</text>
              <view class="comment-rating">
                <block wx:for="{{5}}" wx:key="index">
                  <text class="comment-star {{index < item.rating ? 'active' : ''}}">â­</text>
                </block>
              </view>
            </view>
            <text class="comment-text">{{item.content}}</text>
            <text class="comment-time">{{formatCommentTime(item.time)}}</text>
          </view>
        </view>
      </block>
    </view>
    <view class="add-comment-btn" bindtap="addComment">
      <text class="add-comment-text">ğŸ“ å†™è¯„è®º</text>
    </view>
  </view>

  <!-- åº•éƒ¨ç©ºç™½ -->
  <view class="bottom-space"></view>
</scroll-view>

<!-- åº•éƒ¨æ“ä½œæ  -->
<view class="bottom-bar {{showBottomBar ? 'visible' : ''}}">
  <view class="bottom-action-btn favorite-btn" bindtap="toggleFavorite">
    <text class="bottom-icon">{{bookInfo.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
    <text class="bottom-text">{{bookInfo.isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
  </view>
  <view class="bottom-action-btn download-btn" bindtap="toggleDownload">
    <text class="bottom-icon">{{bookInfo.isDownloaded ? 'ğŸ“‚' : 'â¬‡ï¸'}}</text>
    <text class="bottom-text">{{bookInfo.isDownloaded ? 'å·²ä¸‹è½½' : 'ä¸‹è½½'}}</text>
  </view>
  <view class="main-action-btn" bindtap="goToPlayer">
    <text class="main-icon">â–¶ï¸</text>
    <text class="main-text">æ’­æ”¾</text>
  </view>
</view>

<!-- åˆ†äº«å¼¹çª— -->
<view class="share-modal" wx:if="{{showSharePanel}}">
  <view class="modal-mask" bindtap="hideSharePanel"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">åˆ†äº«ç»™å¥½å‹</text>
    </view>
    <view class="share-options">
      <view class="share-option" bindtap="shareToFriend">
        <text class="share-icon">ğŸ‘¥</text>
        <text class="share-text">åˆ†äº«ç»™æœ‹å‹</text>
      </view>
      <view class="share-option" bindtap="copyLink">
        <text class="share-icon">ğŸ“‹</text>
        <text class="share-text">å¤åˆ¶é“¾æ¥</text>
      </view>
    </view>
  </view>
</view>