<!-- pages/profile/profile.wxml -->
<view class="profile-container">
  <!-- é¡¶éƒ¨æ¸å˜èƒŒæ™¯ -->
  <view class="header-bg"></view>
  
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card" bindtap="onUserCardTap">
    <view class="user-avatar-container">
      <image src="{{userInfo.avatar || '/images/avatar/default.png'}}" class="user-avatar" bindtap="onAvatarTap" />
      <view class="vip-badge" wx:if="{{userInfo.isVip}}">VIP</view>
    </view>
    <view class="user-info">
      <text class="user-name">{{userInfo.nickname || 'æœªç™»å½•'}}</text>
      <text class="user-id">ID: {{userInfo.userId || 'ç‚¹å‡»ç™»å½•'}}</text>
      <view class="user-tags">
        <text class="user-tag" wx:if="{{userInfo.learningDays > 0}}">
          ğŸ“š å­¦ä¹  {{userInfo.learningDays}} å¤©
        </text>
        <text class="user-tag vip-tag" wx:if="{{userInfo.isVip}}">
          â­ VIPä¼šå‘˜
        </text>
        <text class="user-tag level-tag" wx:if="{{userInfo.level && userInfo.level !== 'æœªç™»å½•'}}"  >
              ğŸ† {{userInfo.level}}
        </text>
      </view>
    </view>
    <image src="/images/icons/arrow-right-blue.png" class="arrow-icon" />
  </view>
  
  <!-- ç™»å½•è¿‡æœŸæç¤º -->
  <view class="login-expired-tip" wx:if="{{loginExpired && !showExpiredModal}}">
    <text>âš ï¸ ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•</text>
    <text class="re-login-btn" bindtap="goToLogin">é‡æ–°ç™»å½•</text>
  </view>
  

  
  <!-- å­¦ä¹ æ•°æ®ç»Ÿè®¡ -->
  <view class="stats-section" wx:if="{{hasUserInfo && !loginExpired}}">
    <view class="section-header">
      <text class="section-title">ğŸ“Š å­¦ä¹ ç»Ÿè®¡</text>
      <text class="refresh-btn" bindtap="onRefreshTap" wx:if="{{!isRefreshing}}" style="position: relative; left: 547rpx; top: -71rpx">ğŸ”„ åˆ·æ–°</text>
      <text class="refresh-btn refreshing" wx:if="{{isRefreshing}}">åˆ·æ–°ä¸­...</text>
    </view>
    <view class="stats-grid">
      <view class="stats-item" style="position: relative; left: 0rpx; top: -31rpx">
        <view class="stats-icon">â°</view>
        <text class="stats-value">{{studyData.totalMinutes || 0}}</text>
        <text class="stats-label">å­¦ä¹ æ—¶é•¿(åˆ†é’Ÿ)</text>
      </view>
      <view class="stats-item" style="position: relative; left: 0rpx; top: -31rpx">
        <view class="stats-icon">ğŸ“–</view>
        <text class="stats-value">{{studyData.booksCount || 0}}</text>
        <text class="stats-label">å·²å¬ä¹¦ç±</text>
      </view>
      <view class="stats-item" style="position: relative; left: 0rpx; top: -27rpx">
        <view class="stats-icon">ğŸ”¥</view>
        <text class="stats-value">{{studyData.daysCount || 0}}</text>
        <text class="stats-label">åšæŒå¤©æ•°</text>
      </view>
      <view class="stats-item" style="position: relative; left: 0rpx; top: -27rpx">
        <view class="stats-icon">ğŸ“</view>
        <text class="stats-value">{{studyData.wordsCount || 0}}</text>
        <text class="stats-label">ç´¯è®¡è¯æ±‡</text>
      </view>
    </view>
    
    <!-- æ¯æ—¥ç›®æ ‡è¿›åº¦ -->
    <view class="goal-progress" wx:if="{{studyData.dailyGoal > 0}}" style="position: relative; left: 0rpx; top: -27rpx">
      <view class="progress-header">
        <text>æ¯æ—¥ç›®æ ‡</text>
        <text>{{studyData.goalProgress || 0}}%</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{studyData.goalProgress || 0}}'%'"></view>
      </view>
      <text class="progress-text">
        å·²å®Œæˆ {{Math.floor((studyData.dailyGoal || 30) * (studyData.goalProgress || 0) / 100)}} / {{studyData.dailyGoal || 30}} åˆ†é’Ÿ
      </text>
    </view>
  </view>
  
  <!-- æœªç™»å½•æç¤º -->
  <view class="empty-tips" wx:if="{{!hasUserInfo && !isLoading}}" style="height: 437rpx; display: flex; box-sizing: border-box; left: 4rpx; top: 12rpx; position: relative; width: 693rpx">
    <image src="/images/empty/login-empty.png" class="empty-img" />
    <text class="empty-text" style="position: relative; left: 14rpx; top: -136rpx">ç™»å½•åæŸ¥çœ‹å­¦ä¹ æ•°æ®</text>
    <text class="empty-btn" bindtap="goToLogin" style="position: relative; left: -1rpx; top: -109rpx">ç«‹å³ç™»å½•</text>
  </view>
  
  <!-- åŠŸèƒ½èœå•åŒº -->
  <view class="menu-section">
    <view class="section-title">
      <text class="title-text">ğŸ“š æˆ‘çš„å†…å®¹</text>
      <text class="menu-total">å…± {{bookStats.total || 0}} æœ¬</text>
    </view>
    
    <!-- å·²å®ŒæˆåŠŸèƒ½è¡Œ -->
    <view class="menu-item large" bindtap="goToMyBooks" data-type="completed">
      <view class="menu-icon">âœ…</view>
      <view class="menu-content">
        <text class="menu-text">å·²å®Œæˆ</text>
        <text class="menu-desc">å·²ç»å¬å®Œçš„ä¹¦ç±</text>
      </view>
      <view class="menu-right">
        <text class="menu-count">{{bookStats.completed || 0}} æœ¬</text>
        <image src="/images/icons/arrow-right-blue.png" class="menu-arrow" />
      </view>
    </view>
    
    <!-- å·²ä¸‹è½½åŠŸèƒ½è¡Œ -->
    <view class="menu-item large" bindtap="goToMyBooks" data-type="downloaded">
      <view class="menu-icon">â¬‡ï¸</view>
      <view class="menu-content">
        <text class="menu-text">å·²ä¸‹è½½</text>
        <text class="menu-desc">ç¦»çº¿å¯å¬çš„ä¹¦ç±</text>
      </view>
      <view class="menu-right">
        <text class="menu-count">{{bookStats.downloaded || 0}} æœ¬</text>
        <image src="/images/icons/arrow-right-blue.png" class="menu-arrow" />
      </view>
    </view>
    

    
    <!-- æˆ‘çš„æ”¶è—åŠŸèƒ½è¡Œ -->
    <view class="menu-item large" bindtap="goToMyBooks" data-type="favorites">
      <view class="menu-icon">â¤ï¸</view>
      <view class="menu-content">
        <text class="menu-text">æˆ‘çš„æ”¶è—</text>
        <text class="menu-desc">æ ‡è®°ä¸ºå–œæ¬¢çš„ä¹¦ç±</text>
      </view>
      <view class="menu-right">
        <text class="menu-count">{{bookStats.favorites || 0}} æœ¬</text>
        <image src="/images/icons/arrow-right-blue.png" class="menu-arrow" />
      </view>
    </view>
    
    <view class="menu-divider"></view>
    
    <!-- è®¾ç½®åŠŸèƒ½åŒºåŸŸ -->
    <view class="section-title" style="margin-top: 40rpx;">
      <text class="title-text">âš™ï¸ è®¾ç½®ä¸å¸®åŠ©</text>
    </view>
    
    <view class="menu-item" bindtap="goToHelpCenter">
      <view class="menu-icon">â“</view>
      <text class="menu-text">å¸®åŠ©ä¸­å¿ƒ</text>
      <image src="/images/icons/arrow-right-blue.png" class="menu-arrow" />
    </view>
    
    <view class="menu-item" bindtap="goToFeedback">
      <view class="menu-icon">ğŸ“</view>
      <text class="menu-text">æ„è§åé¦ˆ</text>
      <image src="/images/icons/arrow-right-blue.png" class="menu-arrow" />
    </view>
    
    <view class="menu-item" bindtap="goToSettings">
      <view class="menu-icon">âš™ï¸</view>
      <text class="menu-text">ç³»ç»Ÿè®¾ç½®</text>
      <image src="/images/icons/arrow-right-blue.png" class="menu-arrow" />
    </view>
    
    <view class="menu-item" bindtap="goToAbout">
      <view class="menu-icon">â„¹ï¸</view>
      <text class="menu-text">å…³äºæˆ‘ä»¬</text>
      <image src="/images/icons/arrow-right-blue.png" class="menu-arrow" />
    </view>
    
    <!-- è°ƒè¯•åŠŸèƒ½ï¼ˆä»…å¼€å‘ç¯å¢ƒæ˜¾ç¤ºï¼‰ -->
    <view class="menu-item debug-item" bindtap="clearAllStorage" wx:if="{{debugMode}}">
      <view class="menu-icon">ğŸ—‘ï¸</view>
      <text class="menu-text">æ¸…é™¤æ‰€æœ‰æ•°æ®</text>
    </view>
    
    <view class="menu-divider"></view>
    
    <!-- ç™»å½•/é€€å‡ºæŒ‰é’® -->
    <view class="menu-item logout-item" bindtap="logout" wx:if="{{hasUserInfo && !loginExpired}}">
      <view class="menu-icon">ğŸšª</view>
      <text class="menu-text">é€€å‡ºç™»å½•</text>
    </view>
    
    <view class="menu-item login-item" bindtap="goToLogin" wx:if="{{!hasUserInfo || loginExpired}}">
      <view class="menu-icon">ğŸ”‘</view>
      <text class="menu-text">ç™»å½• / æ³¨å†Œ</text>
      <image src="/images/icons/arrow-right-blue.png" class="menu-arrow" />
    </view>
  </view>
  
  <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
  <view class="version-info">
    <text>è‹±è¯­å¬ä¹¦ v{{version}}</text>
    <text class="copyright">Â© 2023 è‹±è¯­å¬ä¹¦ All Rights Reserved</text>
  </view>
  
  <!-- ç™»å½•è¿‡æœŸå¼¹çª— -->
  <view class="modal-mask" wx:if="{{showExpiredModal}}" bindtap="closeExpiredModal">
    <view class="modal-container" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">âš ï¸ ç™»å½•å·²è¿‡æœŸ</text>
      </view>
      <view class="modal-content">
        <text>æ‚¨çš„ç™»å½•çŠ¶æ€å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•</text>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="closeExpiredModal">ç¨åå†è¯´</button>
        <button class="modal-btn confirm-btn" bindtap="goToLoginFromModal">ç«‹å³ç™»å½•</button>
      </view>
    </view>
  </view>
</view>

<!-- åŠ è½½å¼¹çª— -->
<view class="modal-mask loading-mask" wx:if="{{isLoading}}" catchtap="stopPropagation">
  <view class="loading-modal" catchtap="stopPropagation">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>

<!-- åˆ·æ–°å¼¹çª— -->
<view class="modal-mask loading-mask" wx:if="{{isRefreshing}}" catchtap="stopPropagation">
  <view class="loading-modal" catchtap="stopPropagation">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åˆ·æ–°ä¸­...</text>
    </view>
  </view>
</view>